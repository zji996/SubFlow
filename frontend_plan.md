# SubFlow 前端需求书

## 1. 核心交互模式

### 1.1 设计理念

采用**卡片列表 + 模态弹窗**的模式：

```
┌──────────────────────────────────────────────────────────────────────────────┐
│  SubFlow                                            [+ 新建项目]              │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ── 今天 ──────────────────────────────────────────────────────────────────  │
│                                                                              │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐           │
│  │ 📹 项目 A        │  │ 📹 项目 B        │  │ 📹 项目 C        │           │
│  │                  │  │                  │  │                  │           │
│  │ Stage 4/6       │  │ ✓ 已完成         │  │ Stage 2/6       │           │
│  │ ●●●●○○          │  │ ●●●●●●          │  │ ●●○○○○          │           │
│  │ 处理中...       │  │ [自动]           │  │ 等待确认        │           │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘           │
│                                                                              │
│  ── 昨天 ──────────────────────────────────────────────────────────────────  │
│                                                                              │
│  ┌──────────────────┐  ┌──────────────────┐                                  │
│  │ 📹 项目 D        │  │ 📹 项目 E        │                                  │
│  │                  │  │                  │                                  │
│  │ ✓ 已完成         │  │ ✓ 已完成         │                                  │
│  │ ●●●●●●          │  │ ●●●●●●          │                                  │
│  └──────────────────┘  └──────────────────┘                                  │
│                                                                              │
│  ── 更早 ──────────────────────────────────────────────────────────────────  │
│  ...                                                                         │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 点击卡片 → 模态弹窗

点击卡片后弹出居中模态框，点击遮罩层返回主页：

```
┌──────────────────────────────────────────────────────────────────────────────┐
│░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░│
│░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░│
│░░░░░░░░┌────────────────────────────────────────────────────────┐░░░░░░░░░░░│
│░░░░░░░░│  项目 B - Tesla FSD 翻译                        [×]    │░░░░░░░░░░░│
│░░░░░░░░├────────────────────────────────────────────────────────┤░░░░░░░░░░░│
│░░░░░░░░│                                                        │░░░░░░░░░░░│
│░░░░░░░░│  [Stage 进度条]  ✓ ─ ✓ ─ ✓ ─ ✓ ─ ✓ ─ ✓                 │░░░░░░░░░░░│
│░░░░░░░░│                                                        │░░░░░░░░░░░│
│░░░░░░░░│  ─────────────────────────────────────────────────     │░░░░░░░░░░░│
│░░░░░░░░│                                                        │░░░░░░░░░░░│
│░░░░░░░░│  [字幕预览区]                                           │░░░░░░░░░░░│
│░░░░░░░░│  ┌──────────────────────────────────────────────────┐  │░░░░░░░░░░░│
│░░░░░░░░│  │  大家好，欢迎收看...                              │  │░░░░░░░░░░░│
│░░░░░░░░│  │  What is going on, everybody...                  │  │░░░░░░░░░░░│
│░░░░░░░░│  └──────────────────────────────────────────────────┘  │░░░░░░░░░░░│
│░░░░░░░░│                                                        │░░░░░░░░░░░│
│░░░░░░░░│  [下载区]                                               │░░░░░░░░░░░│
│░░░░░░░░│                                                        │░░░░░░░░░░░│
│░░░░░░░░└────────────────────────────────────────────────────────┘░░░░░░░░░░░│
│░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░│
└──────────────────────────────────────────────────────────────────────────────┘
          ↑ 点击遮罩层（░区域）关闭弹窗，返回主页
```

---

## 2. 卡片分组

### 2.1 时间分组

按日期分组显示：
- **今天**
- **昨天**
- **本周**
- **更早**

### 2.2 卡片内容

```
┌──────────────────────────┐
│  📹 视频封面缩略图        │  ← 可选，没有则显示占位图
│                          │
├──────────────────────────┤
│  项目名称                │
│  ●●●●○○  Stage 4/6      │  ← 进度条 + 阶段
│  处理中... / 已完成 ✓    │  ← 状态文字
│  [自动]                  │  ← 工作流标签
└──────────────────────────┘
```

---

## 3. 项目详情模态框

### 3.1 模态框结构

```
┌────────────────────────────────────────────────────────────────┐
│  项目名称                                               [×]    │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  [Stage 进度条]                                                 │
│  ───●───●───●───●───●───●───                                   │
│    1   2   3   4   5   6                                       │
│                                                                │
│  ────────────────────────────────────────────────────────────  │
│                                                                │
│  [阶段详情栏]                                                   │
│  Stage 1: Audio ✓  12s                                        │
│  Stage 2: VAD ✓    40 segs                                    │
│  Stage 3: ASR ✓    40 segs                                    │
│  Stage 4: Correct ✓  12 corrections                           │
│  Stage 5: Translate ✓  19 chunks                              │
│  Stage 6: Export ✓                                            │
│                                                                │
│  ────────────────────────────────────────────────────────────  │
│                                                                │
│  [字幕预览 + 下载区]  ← Stage 6 完成后显示                       │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

---

## 4. 字幕导出设计（重点）

### 4.1 设计理念

- Stage 6 瞬间完成，不需要等待
- 用户选择字幕样式后下载
- **不提供精细编辑**，精细调整用专业字幕软件

### 4.2 字幕样式选项

**内容排列方式**：

| 选项 | 说明 |
|------|------|
| 双行（译文 + 原文） | 默认，第一行译文，第二行原文 |
| 双行（原文 + 译文） | 第一行原文，第二行译文 |
| 仅译文 | 只显示翻译 |
| 仅原文 | 只显示原文 |

**导出格式**：

| 格式 | 说明 |
|------|------|
| SRT | 最通用，纯文本 |
| VTT | Web 友好 |
| ASS | 支持样式，可设置字体/颜色/大小 |

### 4.3 ASS 样式设置

仅当选择 ASS 格式时显示：

```
┌──────────────────────────────────────────────────────────────┐
│  ASS 样式设置                                                 │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ── 主字幕（译文）──────────────────────────────             │
│  字体      [▼ 思源黑体 / 微软雅黑 / 苹方 / ...]              │
│  字号      [36] px                                           │
│  颜色      [■ #FFFFFF] ← 颜色选择器                          │
│  描边      [■ #000000] 2px                                   │
│                                                              │
│  ── 次字幕（原文）──────────────────────────────             │
│  字体      [▼ Arial / Roboto / ...]                          │
│  字号      [24] px                                           │
│  颜色      [■ #CCCCCC]                                       │
│  描边      [■ #000000] 1px                                   │
│                                                              │
│  ── 位置 ────────────────────────────────────────           │
│  垂直位置  [▼ 底部 / 顶部]                                    │
│  边距      [20] px                                           │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 4.4 样式预览

实时预览当前设置的效果：

```
┌──────────────────────────────────────────────────────────────┐
│                                                              │
│                     ▼ 预览效果 ▼                             │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐  │
│  │                                                        │  │
│  │          （模拟视频画面，灰色背景）                      │  │
│  │                                                        │  │
│  │                                                        │  │
│  │  ┌──────────────────────────────────────────────────┐  │  │
│  │  │         大家好，欢迎收看...                       │  │  │  ← 主字幕样式
│  │  │      What is going on, everybody...              │  │  │  ← 次字幕样式
│  │  └──────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 4.5 下载区域

```
┌──────────────────────────────────────────────────────────────┐
│                                                              │
│  内容排列：  ○ 译文+原文（默认）  ○ 原文+译文                  │
│              ○ 仅译文           ○ 仅原文                     │
│                                                              │
│  导出格式：  ○ SRT  ○ VTT  ● ASS                             │
│                                                              │
│  [ASS 样式设置...]  ← 展开/折叠                               │
│                                                              │
│  [预览]                        [下载字幕]                    │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## 5. 工作流模式

### 5.1 自动工作流

- 创建项目后 Stage 1-6 **全自动运行**
- Stage 6 完成即"已完成"状态
- 用户随时可打开查看进度

### 5.2 手动工作流

- 每个 Stage 完成后暂停
- 用户点击"下一步"继续
- 适合需要检查中间结果的场景

---

## 6. 新建项目模态框

```
┌──────────────────────────────────────┐
│  新建项目                      [×]   │
├──────────────────────────────────────┤
│                                      │
│  项目名称 *                          │
│  ┌──────────────────────────────┐   │
│  │  我的视频翻译                  │   │
│  └──────────────────────────────┘   │
│                                      │
│  视频来源 *                          │
│  ┌──────────────────────────────┐   │
│  │  https://... 或拖拽上传       │   │
│  └──────────────────────────────┘   │
│                                      │
│  源语言（可选）                       │
│  ┌──────────────────────────────┐   │
│  │  ▼ 自动检测 / English / ...  │   │
│  └──────────────────────────────┘   │
│                                      │
│  目标语言 *                          │
│  ┌──────────────────────────────┐   │
│  │  ▼ 中文（简体）               │   │
│  └──────────────────────────────┘   │
│                                      │
│  工作流：  ● 自动（推荐）  ○ 手动     │
│                                      │
│           [取消]  [创建并开始]       │
│                                      │
└──────────────────────────────────────┘
```

---

## 7. API 扩展

### 7.1 字幕下载 API

```
GET /api/projects/{id}/subtitles/download
Query:
  format: srt | vtt | ass
  content: both | primary | secondary
  primary_position: top | bottom  (当 content=both)
  ass_style: { ... }  (当 format=ass)

Response: 字幕文件流
```

### 7.2 字幕预览 API

```
GET /api/projects/{id}/subtitles/preview
Query: (同上)
Response: { preview_text: "...", entries: [...] }
```

---

## 8. 样式规范

### 8.1 卡片样式

```css
.project-card {
  width: 280px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: transform 0.2s, box-shadow 0.2s;
}

.project-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
}
```

### 8.2 模态框样式

```css
.modal-overlay {
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
}

.modal-content {
  max-width: 800px;
  max-height: 90vh;
  border-radius: 16px;
  overflow: auto;
}
```

### 8.3 状态颜色

```css
:root {
  --status-pending: #9ca3af;
  --status-processing: #3b82f6;
  --status-completed: #22c55e;
  --status-failed: #ef4444;
}
```

---

## 9. 组件清单

| 组件 | 说明 |
|------|------|
| `ProjectCard` | 项目卡片 |
| `ProjectModal` | 项目详情模态框 |
| `NewProjectModal` | 新建项目模态框 |
| `StageProgress` | 6 阶段进度条 |
| `SubtitlePreview` | 字幕预览 |
| `SubtitleDownload` | 下载设置区 |
| `AssStyleEditor` | ASS 样式编辑器 |
| `Modal` | 通用模态框容器 |
| `DateGroup` | 日期分组标题 |

---

## 10. 待确认

1. **视频封面**：是否需要自动提取视频封面作为卡片缩略图？
2. **项目删除**：删除确认弹窗，还是直接删除？
3. **批量操作**：是否支持批量删除/导出？

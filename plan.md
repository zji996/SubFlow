# å‰ç«¯é›†æˆ LLM å¥åº·æ£€æŸ¥å®æ–½è®¡åˆ’

## ç›®æ ‡

åœ¨å‰ç«¯å…³é”®ä½ç½®å±•ç¤º LLM æœåŠ¡å¥åº·çŠ¶æ€ï¼Œå¸®åŠ©ç”¨æˆ·åœ¨æ“ä½œå‰äº†è§£ç³»ç»Ÿå¯ç”¨æ€§ã€‚

## è®¾è®¡åŸåˆ™

1. **éä¾µå…¥å¼**ï¼šçŠ¶æ€å±•ç¤ºä¸å¹²æ‰°ä¸»æµç¨‹
2. **æŒ‰éœ€åŠ è½½**ï¼šä¸é¢‘ç¹è½®è¯¢ï¼Œåªåœ¨å…³é”®æ—¶æœºè·å–çŠ¶æ€
3. **æ¸è¿›å¢å¼º**ï¼šçŠ¶æ€è·å–å¤±è´¥ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½

## API æ¥å£

```typescript
// GET /health/llm
interface LLMHealthResponse {
  status: 'healthy' | 'degraded' | 'unhealthy' | 'unknown'
  providers: {
    [key: string]: {  // 'fast' | 'power'
      status: 'ok' | 'error' | 'unknown'
      provider: string  // 'openai' | 'gemini'
      model: string
      last_success_at: string | null
      last_error_at: string | null
      last_error: string | null
      last_latency_ms: number | null
    }
  }
}

// POST /health/llm - æ‰‹åŠ¨è§¦å‘æ£€æŸ¥
// å“åº”æ ¼å¼åŒä¸Š
```

## åŠŸèƒ½å®ç°

### 1. API å®¢æˆ·ç«¯å±‚

æ–°å¢å¥åº·æ£€æŸ¥ API æ¨¡å—ï¼š
- `getLLMHealth()` - è·å–ç¼“å­˜çŠ¶æ€
- `checkLLMHealth()` - æ‰‹åŠ¨è§¦å‘æ£€æŸ¥

### 2. é¡¶éƒ¨å¯¼èˆªæ çŠ¶æ€æŒ‡ç¤ºå™¨

**ä½ç½®**ï¼šLayout Header å³ä¾§

**äº¤äº’è®¾è®¡**ï¼š
- é»˜è®¤æ˜¾ç¤ºå°åœ†ç‚¹æŒ‡ç¤ºå™¨ï¼ˆç›´å¾„ 8-10pxï¼‰
- é¢œè‰²æ˜ å°„ï¼š
  | çŠ¶æ€ | é¢œè‰² | è¯´æ˜ |
  |------|------|------|
  | healthy | ğŸŸ¢ ç»¿è‰² | æ‰€æœ‰æœåŠ¡æ­£å¸¸ |
  | degraded | ğŸŸ¡ é»„è‰² | éƒ¨åˆ†æœåŠ¡å¼‚å¸¸ |
  | unhealthy | ğŸ”´ çº¢è‰² | æ‰€æœ‰æœåŠ¡å¼‚å¸¸ |
  | unknown | âšª ç°è‰² | å°šæ— çŠ¶æ€æ•°æ® |

- æ‚¬æµ®æ˜¾ç¤ºç®€è¦çŠ¶æ€ Tooltip
- ç‚¹å‡»å±•å¼€è¯¦ç»†çŠ¶æ€å¡ç‰‡ï¼ˆå¼¹å‡ºå±‚/ä¸‹æ‹‰é¢æ¿ï¼‰

**çŠ¶æ€è·å–æ—¶æœº**ï¼š
- é¡µé¢é¦–æ¬¡åŠ è½½æ—¶è·å–ä¸€æ¬¡
- ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»åˆ·æ–°æŒ‰é’®æ—¶è§¦å‘æ£€æŸ¥

### 3. æ–°å»ºé¡¹ç›®é¡µè­¦å‘Š

**ä½ç½®**ï¼šè¡¨å•é¡¶éƒ¨ï¼ˆError åŒºåŸŸä¸Šæ–¹æˆ–ä¸‹æ–¹ï¼‰

**è§¦å‘æ¡ä»¶**ï¼šé¡µé¢åŠ è½½æ—¶è·å–çŠ¶æ€

**å±•ç¤ºé€»è¾‘**ï¼š
- `unhealthy`ï¼šçº¢è‰²è­¦å‘Šæ¡†ï¼Œå¼ºçƒˆæç¤º
  ```
  âš ï¸ LLM æœåŠ¡ä¸å¯ç”¨
  å½“å‰æ‰€æœ‰ LLM æœåŠ¡å‡ä¸å¯ç”¨ï¼Œé¡¹ç›®å¤„ç†å°†æ— æ³•è¿›è¡Œã€‚è¯·æ£€æŸ¥æœåŠ¡é…ç½®ã€‚
  ```
- `degraded`ï¼šé»„è‰²æç¤ºæ¡†ï¼Œæ¸©å’Œæç¤º
  ```
  âš ï¸ éƒ¨åˆ† LLM æœåŠ¡å¼‚å¸¸
  Power LLM (gemini-2.0-flash) æœ€è¿‘è°ƒç”¨å¤±è´¥ï¼Œå¯èƒ½å½±å“ç¿»è¯‘è´¨é‡ã€‚
  ```
- `healthy` / `unknown`ï¼šä¸æ˜¾ç¤º

### 4. é¡¹ç›®è¯¦æƒ…é¡µè¿è¡Œæç¤ºï¼ˆå¯é€‰ï¼‰

**ä½ç½®**ï¼šè¿è¡ŒæŒ‰é’®é™„è¿‘

**è§¦å‘æ¡ä»¶**ï¼šç”¨æˆ·ç‚¹å‡»"è¿è¡Œ"æˆ–"ç»§ç»­"æŒ‰é’®æ—¶

**å±•ç¤ºé€»è¾‘**ï¼š
- å¦‚æœçŠ¶æ€å¼‚å¸¸ï¼Œå¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
- ç”¨æˆ·å¯é€‰æ‹©"ä»ç„¶è¿è¡Œ"æˆ–"å–æ¶ˆ"

## ç»„ä»¶è®¾è®¡

### LLMHealthIndicator ç»„ä»¶
```
ä½ç½®ï¼šcomponents/common/LLMHealthIndicator.tsx

Props:
- size?: 'sm' | 'md' | 'lg'  // æŒ‡ç¤ºå™¨å¤§å°
- showLabel?: boolean        // æ˜¯å¦æ˜¾ç¤ºæ–‡å­—æ ‡ç­¾
- onClick?: () => void       // ç‚¹å‡»å›è°ƒ

çŠ¶æ€ç®¡ç†ï¼š
- å†…éƒ¨ state å­˜å‚¨å¥åº·çŠ¶æ€
- å¯¹å¤–æš´éœ² refresh() æ–¹æ³•
```

### LLMHealthPanel ç»„ä»¶
```
ä½ç½®ï¼šcomponents/common/LLMHealthPanel.tsx

å±•ç¤ºè¯¦ç»†çŠ¶æ€ä¿¡æ¯ï¼š
- æ¯ä¸ª Provider çš„çŠ¶æ€å¡ç‰‡
- æœ€åæˆåŠŸ/å¤±è´¥æ—¶é—´
- æœ€åå»¶è¿Ÿ
- é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœ‰ï¼‰
- "åˆ·æ–°çŠ¶æ€"æŒ‰é’®ï¼ˆè§¦å‘ POST /health/llmï¼‰
```

### LLMHealthAlert ç»„ä»¶
```
ä½ç½®ï¼šcomponents/common/LLMHealthAlert.tsx

Props:
- status: LLMHealthResponse
- variant?: 'inline' | 'banner'

æ ¹æ®çŠ¶æ€æ¸²æŸ“ä¸åŒæ ·å¼çš„è­¦å‘Šæ¡†
```

## è§†è§‰è®¾è®¡

### çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼
```css
/* å¥åº· */
.health-dot-healthy {
  background: linear-gradient(135deg, #10b981, #34d399);
  box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
}

/* é™çº§ */
.health-dot-degraded {
  background: linear-gradient(135deg, #f59e0b, #fbbf24);
  box-shadow: 0 0 8px rgba(245, 158, 11, 0.5);
}

/* ä¸å¥åº· */
.health-dot-unhealthy {
  background: linear-gradient(135deg, #ef4444, #f87171);
  box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
  animation: pulse 2s infinite;
}

/* æœªçŸ¥ */
.health-dot-unknown {
  background: linear-gradient(135deg, #6b7280, #9ca3af);
}
```

### è¯¦ç»†é¢æ¿æ ·å¼
- ä½¿ç”¨ç°æœ‰çš„ `glass-card` æ ·å¼
- æ·±è‰²æ¯›ç»ç’ƒèƒŒæ™¯
- ä¸æ•´ä½“è®¾è®¡è¯­è¨€ä¸€è‡´

## éªŒæ”¶æ ‡å‡†

1. **çŠ¶æ€æŒ‡ç¤ºå™¨**
   - åœ¨ Header å³ä¾§å¯è§
   - æ­£ç¡®åæ˜ å½“å‰ LLM å¥åº·çŠ¶æ€
   - ç‚¹å‡»å¯æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯

2. **æ–°å»ºé¡¹ç›®é¡µ**
   - é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
   - unhealthy æ—¶æ˜¾ç¤ºçº¢è‰²è­¦å‘Š
   - degraded æ—¶æ˜¾ç¤ºé»„è‰²æç¤º

3. **è¯¦ç»†é¢æ¿**
   - æ˜¾ç¤ºæ¯ä¸ª Provider çš„çŠ¶æ€
   - å¯æ‰‹åŠ¨åˆ·æ–°çŠ¶æ€
   - åˆ·æ–°æ—¶æœ‰ loading çŠ¶æ€

4. **æ€§èƒ½**
   - é¡µé¢åŠ è½½ä¸é˜»å¡
   - çŠ¶æ€è·å–å¤±è´¥é™é»˜å¤„ç†

## å®æ–½é¡ºåº

1. æ–°å¢ API å®¢æˆ·ç«¯æ¨¡å—
2. å®ç° LLMHealthIndicator ç»„ä»¶
3. é›†æˆåˆ° Layout Header
4. å®ç° LLMHealthPanel è¯¦ç»†é¢æ¿
5. å®ç° LLMHealthAlert è­¦å‘Šç»„ä»¶
6. é›†æˆåˆ° NewProjectPage
7. ï¼ˆå¯é€‰ï¼‰é›†æˆåˆ° ProjectDetailPage

## ä¼˜å…ˆçº§

**ä¸­** - æå‡ç”¨æˆ·ä½“éªŒï¼Œå¸®åŠ©ç”¨æˆ·æå‰å‘ç°æœåŠ¡é—®é¢˜

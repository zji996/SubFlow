# ============================================================================
# SubFlow 环境变量配置模板
# ============================================================================
# 复制此文件为 .env 并填写实际值
# 必填项标记为 [必填]，其余均有合理默认值

# ============================================================================
# 🔑 核心必填配置（快速开始只需配置这些）
# ============================================================================

# --- LLM 配置 [必填：至少配置一个 LLM] ---
# 支持的 Provider: openai, gemini
#
# 方式一：使用 OpenAI / OpenAI 兼容服务（vLLM、Ollama、DeepSeek 等）
LLM_FAST_PROVIDER=openai
LLM_FAST_BASE_URL=https://api.openai.com/v1
LLM_FAST_API_KEY=sk-your-api-key-here
LLM_FAST_MODEL=gpt-4o-mini

# 方式二：使用 Gemini
LLM_POWER_PROVIDER=gemini
LLM_POWER_API_KEY=AIzaSy-your-gemini-api-key
LLM_POWER_MODEL=gemini-2.0-flash
# 可选：自定义端点（代理/Vertex AI）
# LLM_POWER_BASE_URL=https://your-proxy.example.com/v1beta

# --- ASR 配置 [必填] ---
ASR_PROVIDER=glm_asr
ASR_BASE_URL=http://localhost:8000/v1
ASR_API_KEY=abc123
ASR_MODEL=glm-asr

# --- 数据库 [必填：使用 docker-compose 默认值即可] ---
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=subflow
POSTGRES_HOST=localhost
POSTGRES_PORT=5432

# --- Redis [必填] ---
REDIS_URL=redis://localhost:6379

# ============================================================================
# ⚙️ 可选配置（按需调整）
# ============================================================================

# --- 各阶段 LLM 选择 ---
# 指定每个阶段使用 fast 还是 power 配置
LLM_ASR_CORRECTION=fast        # Stage 4：ASR 纠错
LLM_GLOBAL_UNDERSTANDING=fast  # Stage 5 Pass 1：全局理解
LLM_SEMANTIC_TRANSLATION=power # Stage 5 Pass 2：语义翻译（推荐用更强模型）

# --- 并发控制 ---
CONCURRENCY_ASR=50        # ASR 并发数
CONCURRENCY_LLM_FAST=30   # LLM Fast 并发数
CONCURRENCY_LLM_POWER=30  # LLM Power 并发数

# --- 分区并行（Stage 4 + 5 共享）---
PARALLEL_ENABLED=true
PARALLEL_MIN_GAP_SECONDS=2.0

# ============================================================================
# 🖥️ 基础设施配置
# ============================================================================

# --- 目录配置 ---
MODELS_DIR=./models
DATA_DIR=./data
LOG_DIR=./logs

# --- 存储后端 ---
# s3: 适合分布式部署（推荐）
# local: 适合单机部署
ARTIFACT_STORE_BACKEND=s3

# --- S3/MinIO（当 ARTIFACT_STORE_BACKEND=s3 时）---
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
S3_BUCKET_NAME=subflow
S3_PRESIGN_EXPIRES_HOURS=240

# --- 上传限制 ---
UPLOAD_MAX_BYTES=10737418240  # 10GB

# ============================================================================
# 🎛️ 高级配置（通常无需修改）
# ============================================================================

# --- GPU 配置 ---
# 如果 GPU0 被占用，可指定使用 GPU1
# CUDA_VISIBLE_DEVICES=1

# --- 音频处理 ---
AUDIO_NORMALIZE=true
AUDIO_NORMALIZE_TARGET_DB=-1
# 测试时可截断音频（秒），留空=处理完整音频
# AUDIO_MAX_DURATION_S=120
ASR_TIMEOUT=300.0
ASR_MAX_CHUNK_S=15

# --- VAD 参数（已调优，通常无需修改）---
VAD_NEMO_DEVICE=cuda
VAD_THRESHOLD=0.60
VAD_TARGET_MAX_SEGMENT_S=4
VAD_SPLIT_THRESHOLD=0.45
VAD_MIN_SILENCE_DURATION_MS=60
VAD_MIN_SPEECH_DURATION_MS=100
VAD_SPLIT_SEARCH_BACKTRACK_RATIO=0.7
VAD_SPLIT_SEARCH_FORWARD_RATIO=0.03
VAD_SPLIT_GAP_S=0

# ============================================================================
# 📁 目录结构说明
# ============================================================================
# DATA_DIR (默认 ./data) 包含：
#   - blobs/     : 大文件去重存储（视频/音频，按 SHA256 hash）
#   - uploads/   : 用户上传文件（当 ARTIFACT_STORE_BACKEND=local）
#   - projects/  : 临时工作目录（可定期清理）
#   - exports/   : 本地导出文件缓存
